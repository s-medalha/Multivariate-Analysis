---
title: "Multivariate Analysis"
author:
  - Ana Rasinhas
  - Daniela Gon√ßalves
  - Pedro Fernandes
  - Ricardo Branco
  - Samuel Medalha
date: last-modified
format:
  pdf: default
execute:
  echo: false
editor_options: 
  chunk_output_type: console
---

```{r}
#| label: load-packages
#| include: false

library(tidyverse)
library(readxl)
library(psych)
```

```{r}
#| label: import-data
#| include: false


selected_vars <- c(
  "country", "d11", "qa1",                          # Demographics / Administrative
  "qa2_1", "qa2_2",                                 # QA2 (Environmental Seriousness/Perception)
  "qa3_1", "qa3_2", "qa3_3", "qa3_4", "qa3_5", "qa3_6", "qa3_7", "qa3_8", "qa3_9", "qa3_10",
  "qa4_1", "qa4_2", "qa4_3", "qa4_4", "qa4_5", "qa4_6", "qa4_7", "qa4_8", "qa4_9", "qa4_10", "qa4_11", "qa4_12", "qa4_13",
  "qa6_1", "qa6_2", "qa6_3", "qa6_4", "qa6_5", "qa6_6", "qa6_7", "qa6_8", "qa6_9", "qa6_10", "qa6_11", "qa6_12", "qa6_13", "qa6_14",
  "qa7_1", "qa7_2", "qa7_3", "qa7_4", "qa7_5", "qa7_6",
  "qa12_1", "qa12_2", "qa12_3", "qa12_4", "qa12_5",
  "qa13_1", "qa13_2", "qa13_3", "qa13_4", "qa13_5", "qa13_6",
  "qa14_1", "qa14_2", "qa14_3", "qa14_4"
)

# Reducing the number of variables for Analysis and clean all the answers with DK - Don't Kown
fa_eurob2 <- eurob2 %>%
  select(all_of(selected_vars)) %>% 
  filter(
    if_all(starts_with("qa7"), ~ . != 5),
    if_all(starts_with("qa12"), ~ . != 5),
    if_all(starts_with("qa13"), ~ . != 5),
    if_all(starts_with("qa14"), ~ . != 5)
  )


data <- fa_eurob2 %>%
  select("qa7_1", "qa7_2", "qa7_3", "qa7_4", "qa7_5", "qa7_6",
  "qa12_1", "qa12_2", "qa12_3", "qa12_4", "qa12_5",
  "qa13_1", "qa13_2", "qa13_3", "qa13_4", "qa13_5", "qa13_6",
  "qa14_1", "qa14_2", "qa14_3", "qa14_4")

```


## Abstract

## Introduction

## Methodology
```{r}
#| label: KMO
#| warning: false

KMO(data)
```
After executing the Kaiser-Meyer-Olkin test, the MSA (measure of sampling accuracy, which varies between 0 and 1) is calculated as `r format(KMO(data)$MSA, digits = 2)`. This is classified as "meritorious", so we have an indication that factor analysis is suitable for this data set.

We'll start by performing factor analysis with a high number of values:

```{r}
#| label: first_fa
#| warnings: false
#| echo: true
fa <- fa(data, nfactors = 5, rotate = "varimax") 
print(fa$e.values, sort = TRUE, decreasing = TRUE)
```
There are 3 eigenvalues greater than 1.

```{r}
#| label: cumulative_var
print(fa$Vaccounted, digits = 2)
```
However, 10 factors aren't enough to explain 80% of the variance (???)

```{r}
#| label: scree_plot
scree(data, factors = FALSE)
```

```{r}
fa_3_varimax <- fa(data,
  nfactors = 6,
  fm="pa",
  rotate = "varimax")
```

```{r}
fa.diagram(fa_3_varimax, errors = FALSE)
```

```{r}
factor_scores <- factor.scores(f = fa_3_varimax, x = data)
scores <- cbind(country_data, factor_scores$scores) %>% group_by(cntry) %>% summarize(PA1 = mean(PA1), PA2 = mean(PA2), PA3 = mean(PA3), PA4 = mean(PA4), PA5 = mean(PA5), PA6 = mean(PA6))
```




## Results

## Discussion

## Conclusions

## References